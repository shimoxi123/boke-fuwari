# 百度统计配置指南

## 📋 配置概览

我已经为你的博客配置了完整的百度统计系统，包括：

1. **网站统计代码** - 用于收集访问数据
2. **API集成** - 用于获取和显示统计数据
3. **统计组件** - 用于在页面中展示数据

## 🔧 配置步骤

### 1. 获取百度统计站点ID

你需要从百度统计后台获取你的站点ID：

1. 登录 [百度统计](https://tongji.baidu.com/)
2. 添加你的网站
3. 获取统计代码中的站点ID（类似：`1234567890abcdef`）

### 2. 更新环境变量

✅ **API密钥已配置完成**

你的API密钥已经在 `.env` 文件中正确配置：
- API Key: `Um9SJ4AqQkUthkTF3RGhCLLzTT192SX0`
- Secret Key: `wFC0aui8dzyHZnBPlR6Z6UhOMoBD57xo`

⚠️ **还需要设置站点ID**

请按以下步骤获取并设置站点ID：

1. 登录 [百度统计](https://tongji.baidu.com/)
2. 在左侧菜单选择"管理" → "代码管理"
3. 找到你的网站，点击"获取代码"
4. 在统计代码中找到类似这样的代码：
   ```javascript
   var _hmt = _hmt || [];
   (function() {
     var hm = document.createElement("script");
     hm.src = "https://hm.baidu.com/hm.js?xxxxxxxxxxxxxxxx";  // 这里的x就是你的站点ID
   })();
   ```
5. 复制站点ID（通常是16位字符），然后在 `.env` 文件中更新：

```env
# 百度统计配置
BAIDU_ANALYTICS_API_KEY=Um9SJ4AqQkUthkTF3RGhCLLzTT192SX0
BAIDU_ANALYTICS_SECRET_KEY=wFC0aui8dzyHZnBPlR6Z6UhOMoBD57xo

# 百度统计站点ID（替换为你从百度统计后台获取的实际站点ID）
BAIDU_ANALYTICS_SITE_ID=your_actual_site_id_here
```

### 3. 验证配置

配置完成后，你的网站将自动：
- 加载百度统计代码
- 开始收集访问数据
- 提供API接口获取统计数据

## 🎯 功能特性

### 自动统计代码注入
- 统计代码会自动注入到每个页面
- 支持配置开关，可随时启用/禁用
- 使用环境变量管理站点ID，更安全

### API数据获取
- 提供 `/api/analytics` 接口获取统计数据
- 支持获取概览数据、实时数据等
- 自动处理访问令牌获取和刷新

### 统计数据展示组件
- `BaiduAnalytics.astro` 组件可在任意页面显示统计数据
- 响应式设计，支持暗色模式
- 优雅的错误处理和加载状态

## 📊 功能说明

### 网站整体统计
使用统计组件显示网站整体数据：

```astro
---
import BaiduAnalytics from '@/components/BaiduAnalytics.astro';
---

<!-- 显示统计数据 -->
<BaiduAnalytics showStats={true} />

<!-- 或者在特定位置显示 -->
<BaiduAnalytics showStats={true} className="my-8" />
```

### 单篇文章阅读量统计
✅ **已自动集成**

每篇博客文章现在会自动显示真实的阅读量数据：

- **数据来源**：优先使用百度统计的真实数据
- **回退机制**：如果百度统计API不可用，会回退到本地浏览器统计
- **缓存优化**：数据会缓存5分钟，避免频繁请求API
- **显示位置**：
  - 文章列表页面：每个文章卡片显示阅读量
  - 文章详情页面：顶部和底部统计区域显示阅读量

### 工作原理
1. **首次加载**：显示缓存的数据（如果有）
2. **后台获取**：异步从百度统计API获取真实数据
3. **数据更新**：用真实数据替换显示内容
4. **错误处理**：API失败时自动回退到本地统计

## 🔗 API接口使用

### 获取概览数据
```javascript
// 获取最近7天数据
fetch('/api/analytics?type=overview')
  .then(res => res.json())
  .then(data => console.log(data));

// 获取指定日期范围数据
fetch('/api/analytics?type=overview&start_date=20240801&end_date=20240807')
  .then(res => res.json())
  .then(data => console.log(data));
```

### 获取实时数据
```javascript
fetch('/api/analytics?type=realtime')
  .then(res => res.json())
  .then(data => console.log(data));
```

## ⚙️ 配置选项

在 `src/config.ts` 中的 `baiduAnalyticsConfig` 对象：

```typescript
export const baiduAnalyticsConfig: BaiduAnalyticsConfig = {
  enable: true,  // 启用/禁用百度统计
  siteId: "your_site_id",  // 站点ID
  apiKey: "your_api_key",  // API密钥
  secretKey: "your_secret_key",  // Secret密钥
};
```

## 🛡️ 安全注意事项

1. **环境变量保护**：API密钥存储在 `.env` 文件中，不会暴露给客户端
2. **API限制**：百度统计API有调用频率限制，建议合理使用
3. **缓存策略**：API响应已设置5分钟缓存，减少不必要的请求

## 🚀 部署注意事项

部署到生产环境时，确保：

1. 在部署平台（Netlify/Vercel等）设置环境变量
2. 将 `.env` 文件添加到 `.gitignore`（已配置）
3. 验证统计代码是否正常加载

## 📈 数据说明

统计组件显示的数据包括：
- **页面浏览量（PV）**：页面被访问的总次数
- **访客数（UV）**：独立访客数量
- **IP数**：独立IP地址数量

数据默认显示最近7天的汇总信息。

## 🔧 故障排除

### 统计代码不加载
1. 检查 `baiduAnalyticsConfig.enable` 是否为 `true`
2. 确认 `BAIDU_ANALYTICS_SITE_ID` 环境变量已设置
3. 查看浏览器控制台是否有错误

### API数据获取失败
1. 验证API密钥是否正确
2. 检查网络连接
3. 确认百度统计账户权限

### 统计数据不显示
1. 确保网站已有足够的访问数据
2. 检查日期范围设置
3. 查看API响应是否正常

---

## 📞 获取帮助

如果遇到问题，可以：
1. 查看百度统计官方文档
2. 检查浏览器开发者工具的网络和控制台面板
3. 确认所有配置项都已正确设置

配置完成后，你的博客就拥有了完整的访问统计功能！🎉